<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Torne-se Premium</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

<style>
body{
  margin:0;
  min-height:100vh;
  font-family: Inter, system-ui, Arial, sans-serif;
  background: radial-gradient(circle at top, #0f2a55, #020617);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  width:95%;
  max-width:520px;
  background:rgba(2,6,23,.85);
  border-radius:18px;
  padding:28px;
  box-shadow:0 0 40px rgba(0,0,0,.6);
}
h1{
  margin:0 0 8px;
  text-align:center;
}
.subtitle{
  text-align:center;
  opacity:.85;
  margin-bottom:20px;
}
.plans{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
}
.plan{
  border:1px solid #1e3a8a;
  border-radius:14px;
  padding:18px;
  text-align:center;
}
.plan.popular{ border-color:#2563eb }
.plan.best{ border-color:#16a34a }
.price{
  font-size:22px;
  font-weight:700;
  margin:6px 0 14px;
}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:10px;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
  background:#2563eb;
  color:#fff;
}
button.green{ background:#16a34a }
button:disabled{
  opacity:.6;
  cursor:not-allowed;
}
.status{
  text-align:center;
  margin-top:18px;
  font-size:14px;
}
.premium-ok{
  background:#16a34a;
  padding:10px;
  border-radius:10px;
  text-align:center;
  margin-bottom:16px;
}
</style>
</head>

<body>

<div class="card">

  <h1>⭐ Torne-se Premium</h1>
  <div class="subtitle">
    Acesso total aos simulados e estatísticas avançadas
  </div>

  <div id="premiumBox" style="display:none" class="premium-ok">
    ✅ Você já é Premium
  </div>

  <div class="plans" id="plansBox">
    <div class="plan popular">
      <strong>6 meses</strong>
      <div class="price">R$ 29,90</div>
      <button onclick="assinar('6m')">Assinar agora</button>
    </div>

    <div class="plan best">
      <strong>12 meses</strong>
      <div class="price">R$ 49,90</div>
      <button class="green" onclick="assinar('12m')">Assinar agora</button>
    </div>
  </div>

  <div class="status" id="status">Verificando conta…</div>

</div>

<script>
/* ===============================
   CONFIG FIREBASE
================================ */
firebase.initializeApp({
  apiKey: "SUA_API_KEY",
  authDomain: "simulados-concursos-22c91.firebaseapp.com",
});

/* ===============================
   HELPERS
================================ */
const FUNCTIONS_BASE =
  "https://us-central1-simulados-concursos-22c91.cloudfunctions.net";

function setStatus(msg){
  document.getElementById("status").innerText = msg;
}

/* ===============================
   AUTH STATE
================================ */
firebase.auth().onAuthStateChanged(async user=>{
  if(!user){
    setStatus("Faça login para continuar");
    return;
  }

  try{
    const token = await user.getIdToken();

    const r = await fetch(FUNCTIONS_BASE + "/checkPremium",{
      headers:{
        Authorization:"Bearer " + token
      }
    });

    const j = await r.json();

    if(j.premium){
      document.getElementById("premiumBox").style.display="block";
      document.getElementById("plansBox").style.display="none";
      setStatus("Plano ativo até " + j.premiumUntil);
    }else{
      setStatus("Escolha um plano");
    }

  }catch(e){
    console.error(e);
    setStatus("Erro ao verificar plano");
  }
});

/* ===============================
   ASSINAR
================================ */
async function assinar(planId){
  setStatus("Gerando pagamento…");

  const user = firebase.auth().currentUser;
  if(!user){
    setStatus("Usuário não autenticado");
    return;
  }

  try{
    const token = await user.getIdToken();

    const r = await fetch(FUNCTIONS_BASE + "/createCheckout",{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        Authorization:"Bearer " + token
      },
      body:JSON.stringify({ planId })
    });

    const j = await r.json();

    if(!j.ok){
      setStatus("Erro ao iniciar pagamento");
      console.error(j);
      return;
    }

    window.location.href = j.init_point;

  }catch(e){
    console.error(e);
    setStatus("Falha ao criar pagamento");
  }
}
</script>

</body>
</html>
