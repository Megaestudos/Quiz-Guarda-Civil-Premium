<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Painel Admin | Plataforma de Simulados</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b1220;
  --card:#0f172a;
  --border:#1e293b;
  --primary:#2563eb;
  --primary-dark:#1e40af;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --radius:20px;
}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Arial,sans-serif;
  background: radial-gradient(900px 600px at 15% 15%, rgba(37,99,235,.18), transparent 60%), radial-gradient(800px 600px at 85% 20%, rgba(16,185,129,.12), transparent 60%), var(--bg);
  color:var(--text);
}
.page{
  padding:32px;
  max-width:1200px;
  margin:auto;
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:24px;
}
.header h1{margin:0;font-size:28px}
.header button{
  padding:10px 20px;
  border:none;
  border-radius:14px;
  font-weight:700;
  cursor:pointer;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;
}
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.45);
  backdrop-filter:blur(12px);
}
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  text-align:left;
  padding:12px;
}
th{
  border-bottom:1px solid var(--border);
}
button.csv{
  padding:10px 16px;
  border:none;
  border-radius:12px;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;
  cursor:pointer;
  font-weight:600;
  margin-top:10px;
}
</style>
</head>
<body>
<div class="page">
  <div class="header">
    <h1>Painel Admin</h1>
    <button id="btnLogout">Sair</button>
  </div>

  <div class="card">
    <strong>Total de Usuários: </strong><span id="totalUsers">0</span>
  </div>

  <div class="card">
    <h3>Usuários</h3>
    <table>
      <thead>
        <tr><th>Email</th><th>Último Login</th></tr>
      </thead>
      <tbody id="userTable">
      </tbody>
    </table>
    <button class="csv" id="exportCSV">Exportar CSV</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB36ZszS8v_DeOn3at7zEo_tFq86WU0sI4",
  authDomain: "simulados-concursos-22c91.firebaseapp.com",
  projectId: "simulados-concursos-22c91"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const $ = id => document.getElementById(id);

$("btnLogout").onclick = async ()=>{
  await signOut(auth);
  window.location.href="login.html";
}

onAuthStateChanged(auth, async user=>{
  if(!user){
    window.location.href="login.html";
    return;
  }

  const usersCol = collection(db,"users");
  const usersSnapshot = await getDocs(usersCol);
  const users = usersSnapshot.docs.map(doc=>({id:doc.id,...doc.data()}));

  $("totalUsers").innerText = users.length;

  const tbody = $("userTable");
  tbody.innerHTML="";
  users.forEach(u=>{
    const tr = document.createElement("tr");
    const lastLogin = u.lastLogin ? new Date(u.lastLogin).toLocaleString() : "—";
    tr.innerHTML=`<td>${u.email}</td><td>${lastLogin}</td>`;
    tbody.appendChild(tr);
  });

  // CSV export
  $("exportCSV").onclick=()=>{
    let csv="Email,Último Login\n";
    users.forEach(u=>{
      const last = u.lastLogin ? new Date(u.lastLogin).toLocaleString() : "";
      csv+=`${u.email},${last}\n`;
    });
    const blob = new Blob([csv], {type:"text/csv"});
    const url = URL.createObjectURL(blob);
    const a=document.createElement("a");
    a.href=url;
    a.download="usuarios.csv";
    a.click();
    URL.revokeObjectURL(url);
  }
});
</script>
</body>
</html>
